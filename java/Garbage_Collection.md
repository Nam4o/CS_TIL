# Garbage Collection

> 자바의 메모리 관리 방법 중의 하나로 JVM의 Heap 영역에서 `동적으로 할당했던 메모리` 중 `필요없게 된 메모리 객체`를 모아 주기적으로 제거하는 프로세스

- C / C ++ 언어 에서는 수동으로 메모리 할당 & 해제를 해야하지만, Java 에서는 가비지 컬렉터가 메모리관리를 대행
- 개발자 입장에서 메모리 관리, 누수 문제에 대해 관리하지 않아도 되어 개발에 집중 가능
- 자바에 국한되지 않고 파이썬, JS 등 많은 프로그래밍 언어에서 가비지 컬렉션이 기본으로 내장
- 자바 메모리는 `Young`, `Old`, `Perm`의 세 영역으로 나뉜다.
- 객체는 처음 생성되었을 때 `Young` 영역에 있다가 `Old` 영역으로 넘어가게 되는데, `Old` 영역이 꽉 찼을 때 `Full GC`이 발생하게 된다.
- `Full GC`이 발생하면 애플리케이션에 부하가 발생하며 `Full GC` 발생 순간에 성능이 저하된다.

---

### Young 영역

- 새롭게 생성된 객체가 할당되는 영역
- 대부분의 객체가 금방 Unreachable` 상태가 되기 때문에, 많은 객체가 Young 영역에 생성되었다가 사라진다.
- Young 영역에 대한 가비지 컬렉션을 Minor GC 라고 부른다.

### Old 영역

- Young 영역에서 Reachable 상태를 유지하여 살아남은 객체가 복사되는 영역
- Young 영역보다 크게 할당되며, 영역의 크기가 큰 만큼 가비지는 적게 발생한다.
- Old 영역에 대한 가비지 컬렉션을 Major GC 또는 **`Full GC`** 라고 부른다.
  \*Full GC (Major GC)가 일어나면 Thread 가 멈추고 Mark and Sweep 작업을 해야해서 CPU 에 부하를 주기 때문에 성능이 저하된다.

---

### 단점

- 메모리가 정확히 언제 해제되는지 알 수 없어 제어가 힘듦
- 가비지 컬렉션이 동작하는 동안에는 다른 동작을 멈추기 때문에 오버헤드가 발생됨 (Stop-The-World)
  \*Stop-The-World : 가비지 컬렉션을 수행하기 위해 JVM 이 프로그램 실행을 멈추는 현상
- 가비지 컬렉션이 자주 실행되면 소프트웨어 성능 하락의 문제가 되기도 한다.

---

### 가비지 컬렉션 대상

- 가비지 컬렉션은 특정 개체가 garbage 인지 판단하기 위해 도달성, 도달능력(`Reachability`) 이라는 개념을 적용한다.
- 객체에 레퍼런스가 있다면 `Reachable`로 구분되고, 객체에 유효한 레퍼런스가 없다면 `Unreachable`로 구분하여 수거한다. \*`Reachable`: 객체가 참조되고 있는 상태 `Unreachable`: 객체가 참조되고 있지 않은 상태 (가비지 컬렉션의 대상)

---

### 가비지 컬렉션 청소 방식

#### Mark and Sweep

- 다양한 가비지 컬렉션에서 사용되는 객체를 솎아내는 내부 알고리즘 (가비지 컬렉션이 동작하는 아주 기초적인 청소 과정)
- 가비지 컬렉션이 `Unreachable`한 객체를 식별(`Mark`)하고 제거(`Sweep`)하여 객체가 제거되어 파편화된 메모리 영역을 앞에서부터 채워나가는 작업(`Compaction`)을 수행하게 된다.
